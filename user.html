<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Platto | Premium Digital Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="user-style.css">
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

    <div id="loader" class="loader-overlay"><div class="spinner"></div></div>

    <div class="app-wrapper">
        <!-- Header -->
        <header class="main-header">
            <div class="header-top">
                <img id="res-logo" src="https://via.placeholder.com/60" alt="Logo" class="res-logo-img">
                <div class="res-meta">
                    <h1 id="res-name-display">Loading...</h1>
                    <div class="social-row">
                        <a id="link-fb" href="#" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a id="link-ig" href="#" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a id="link-yt" href="#" target="_blank"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <div class="header-badges">
                <span class="badge">Table <b id="tbl-no">--</b></span>
                <span class="badge">‚è≥ <b id="wait-time">20</b> min</span>
                <div id="wifi-display" class="wifi-badge" style="display:none;">
                    <i class="fas fa-wifi"></i> <span id="wifi-name"></span> | <small id="wifi-pass"></small>
                </div>
            </div>
        </header>

        <!-- Loyalty Strip -->
        <section class="loyalty-section">
            <div class="loyalty-card">
                <div class="pts-circle"><small>PTS</small><h2 id="user-pts">0</h2></div>
                <div class="loyalty-details">
                    <p>Earn 10 points for every ‚Çπ100 spent! üéÅ</p>
                    <small>1000 Pts = ‚Çπ10 Discount</small>
                </div>
            </div>
        </section>

        <!-- Search & Filter -->
        <div class="menu-sticky-nav">
            <input type="text" id="menu-search" placeholder="Search dish..." onkeyup="window.filterMenu()">
            <div class="nav-filters">
                <label class="veg-label">
                    <input type="checkbox" id="veg-toggle" onchange="window.filterMenu()">
                    <span class="veg-indicator">Veg Only üü¢</span>
                </label>
                <button class="offers-pill" onclick="window.openOffersModal()"><i class="fas fa-percent"></i> Offers</button>
            </div>
        </div>

        <main id="menu-list" class="food-container"></main>

        <section class="footer-section">
            <p id="res-about-text">...</p>
            <div class="support-btns">
                <a id="whatsapp-btn" href="#" class="btn-wa"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                <button onclick="window.openSupportModal()" class="btn-ticket"><i class="fas fa-headset"></i> Support</button>
            </div>
        </section>
    </div>

    <!-- BOTTOM NAV (Toggled between Login and Profile based on User Auth) -->
    <nav class="app-bottom-nav">
        <button onclick="window.scrollTo(0,0)" class="active"><i class="fas fa-utensils"></i><span>Menu</span></button>
        <button onclick="window.openCartModal()"><i class="fas fa-shopping-basket"></i><span>Cart</span></button>
        <button onclick="window.openTracking()"><i class="fas fa-route"></i><span>Track</span></button>
        
        <!-- Button logic handled in JS -->
        <button id="nav-auth-btn" onclick="window.openAuthModal()"><i class="fas fa-user-circle"></i><span>Login</span></button>
        <button id="nav-profile-btn" onclick="window.openProfileModal()" style="display:none;"><i class="fas fa-id-card"></i><span>Profile</span></button>
    </nav>

    <!-- FLOATING CART BAR -->
    <div id="cart-bar" class="cart-floating-bar" style="display:none;" onclick="window.openCartModal()">
        <div class="cart-details"><span id="cart-qty">0</span> Items | ‚Çπ<span id="cart-total">0</span></div>
        <button>View Cart ‚Üí</button>
    </div>

    <!-- MODALS -->
    <!-- Cart Modal with Redeem Option -->
    <div id="cartModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header"><h3>My Cart</h3><span class="close-modal" onclick="window.closeModal('cartModal')">&times;</span></div>
            <div id="cart-items-list" class="cart-list"></div>
            
            <!-- Redeem Points UI -->
            <div id="redeem-section" class="redeem-box" style="display:none;">
                <div class="redeem-info">
                    <i class="fas fa-gift"></i>
                    <span>Redeem 1000 Points for ‚Çπ10 Discount?</span>
                </div>
                <button id="apply-redeem-btn" onclick="window.applyRedeem()">Apply Reward</button>
            </div>

            <div class="summary-line"><span>Subtotal</span><b id="summary-subtotal">‚Çπ0</b></div>
            <div id="discount-line" class="summary-line" style="display:none; color:green;"><span>Redeem Discount</span><b>-‚Çπ10</b></div>
            <button class="primary-btn" onclick="window.openPaymentModal()">Checkout</button>
        </div>
    </div>

    <!-- Profile Modal (Update Name & Phone) -->
    <div id="profileModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header"><h3>My Profile</h3><span class="close-modal" onclick="window.closeModal('profileModal')">&times;</span></div>
            <div class="profile-pts-card">
                <small>Available Points</small>
                <h2 id="profile-pts">0</h2>
            </div>
            <input type="text" id="user-name" placeholder="Your Name" class="pro-input">
            <input type="tel" id="user-phone" placeholder="Mobile Number" class="pro-input">
            <button class="primary-btn" onclick="window.saveUserProfile()">Save Profile</button>
            <button class="btn-text" style="color:red; margin-top:20px;" onclick="window.logout()">Logout</button>
        </div>
    </div>

    <!-- Auth Modal (Login/Signup) -->
    <div id="authModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <h2 id="auth-title">Welcome to Platto</h2>
            <div class="auth-tabs">
                <button id="tab-login" class="active" onclick="window.toggleAuth('login')">Login</button>
                <button id="tab-signup" onclick="window.toggleAuth('signup')">Sign Up</button>
            </div>
            <input type="email" id="auth-email" placeholder="Email" class="pro-input">
            <input type="password" id="auth-pass" placeholder="Password" class="pro-input">
            <button class="primary-btn" id="auth-action-btn" onclick="window.handleAuth()">Submit</button>
            <button class="btn-text" onclick="window.closeModal('authModal')">Close</button>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <h3>Final Checkout</h3>
            <input type="text" id="cust-name" placeholder="Confirm Name" class="pro-input">
            <div class="pay-modes">
                <button onclick="window.setPayMode('Online')" id="mode-online" class="pay-mode-btn">üí≥ Online</button>
                <button onclick="window.setPayMode('Cash')" id="mode-cash" class="pay-mode-btn">üíµ Cash</button>
            </div>
            <div id="qr-area" style="display:none;"><div id="payment-qr" class="qr-container"></div></div>
            <textarea id="chef-note" class="pro-input" placeholder="Note for chef..."></textarea>
            <button id="final-confirm-btn" class="primary-btn" onclick="window.confirmOrder()" disabled>Place Order ‚Çπ<span id="final-amt">0</span></button>
        </div>
    </div>

    <!-- Success Screen -->
    <div id="success-screen" class="success-screen-overlay" style="display:none;">
        <div class="success-card">
            <div class="check-circle">‚úì</div>
            <h1>Order Placed!</h1>
            <p>Thank you <b id="s-name"></b>. Table: <b id="s-table"></b></p>
            <button class="primary-btn" onclick="window.closeSuccess()">Back to Menu</button>
        </div>
    </div>

    <script type="module" src="user-script.js"></script>
</body>
</html>